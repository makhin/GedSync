# Wave Compare Threshold Fix

## –î–∞—Ç–∞: 2025-12-14

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ wave-compare —Å adaptive —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –±—ã–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–µ—Ä—Å–æ–Ω—ã —Å –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–º —Å—Ö–æ–¥—Å—Ç–≤–æ–º:

**–ü—Ä–∏–º–µ—Ä –ª–æ–∂–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:**
- **Source**: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ –®–æ—Ç–∞–µ–≤–Ω–∞ –ó–∞–π—Ü–µ–≤–∞ (1975) [@I500005@]
- **Destination**: –î–∞—Ä—å—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞ –ö–ª–∏–º–µ–Ω–∫–æ (1985) [@I6000000207133980738@]
- **Match Score**: 41%
- **Threshold Used**: 35%
- **Result**: ‚úì MATCHED (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)

**–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- –†–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ ‚â† –î–∞—Ä—å—è
- –†–∞–∑–Ω—ã–µ —Ñ–∞–º–∏–ª–∏–∏: –ó–∞–π—Ü–µ–≤–∞ ‚â† –ö–ª–∏–º–µ–Ω–∫–æ
- –†–∞–∑–Ω–∏—Ü–∞ –≤ –¥–∞—Ç–∞—Ö —Ä–æ–∂–¥–µ–Ω–∏—è: 10 –ª–µ—Ç (1975 vs 1985)
- Score 41% –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ –±–∞–∑–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –≤ `ThresholdCalculator.cs`:

| –¢–∏–ø —Å–≤—è–∑–∏ | –°—Ç–∞—Ä—ã–π –ø–æ—Ä–æ–≥ | –° –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π (1 –∫–∞–Ω–¥–∏–¥–∞—Ç) |
|-----------|-------------|-------------------------------|
| Spouse    | 40          | 35 (-5)                       |
| Parent    | 45          | 40-45 (0 –∏–ª–∏ -5)              |
| Sibling   | 55          | 50-60 (+5 –∏–ª–∏ -5)             |

## –†–µ—à–µ–Ω–∏–µ

–ü–æ–≤—ã—à–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

| –¢–∏–ø —Å–≤—è–∑–∏ | –°—Ç–∞—Ä—ã–π | –ù–æ–≤—ã–π | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|-----------|--------|-------|-----------|
| Spouse    | 40     | **55** | +15      |
| Parent    | 45     | **55** | +10      |
| Sibling   | 55     | **60** | +5       |
| Child     | 50     | 50    | 0        |

### –ù–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (—Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞–º–∏):

| –¢–∏–ø —Å–≤—è–∑–∏ | –ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ | –°—Ç–∞—Ä—ã–π –ø–æ—Ä–æ–≥ | –ù–æ–≤—ã–π –ø–æ—Ä–æ–≥ |
|-----------|------------|--------------|-------------|
| Spouse    | 1          | 35%          | **50%**     |
| Parent    | 2          | 45%          | **55%**     |
| Sibling   | 3-4        | 60%          | **65%**     |

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª**: [GedcomGeniSync.Core/Services/Wave/ThresholdCalculator.cs](../GedcomGeniSync.Core/Services/Wave/ThresholdCalculator.cs:35-38)

```diff
 var baseByRelation = relation switch
 {
     RelationType.Anchor => 100,
-    RelationType.Spouse => 40,    // –°—É–ø—Ä—É–≥–∏ –≤ —Å–µ–º—å–µ
-    RelationType.Parent => 45,    // –†–æ–¥–∏—Ç–µ–ª–∏
+    RelationType.Spouse => 55,    // –°—É–ø—Ä—É–≥–∏ –≤ —Å–µ–º—å–µ (–±—ã–ª–æ 40, –ø–æ–≤—ã—à–µ–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
+    RelationType.Parent => 55,    // –†–æ–¥–∏—Ç–µ–ª–∏ (–±—ã–ª–æ 45, –ø–æ–≤—ã—à–µ–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
     RelationType.Child => 50,     // –î–µ—Ç–∏
-    RelationType.Sibling => 55,   // –°–∏–±–ª–∏–Ω–≥–∏
+    RelationType.Sibling => 60,   // –°–∏–±–ª–∏–Ω–≥–∏ (–±—ã–ª–æ 55, –ø–æ–≤—ã—à–µ–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
     _ => 60
 };
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ç–∞—Ä—ã–µ –ø–æ—Ä–æ–≥–∏ (max-level=3):
```
Mapped: 30/3069 persons
Validation Issues: 7
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- I500005 (–ú–∞–≥–¥–∞–ª–∏–Ω–∞, 1975) ‚úì MATCHED —Å I6000000207133980738 (–î–∞—Ä—å—è, 1985) - **–õ–û–ñ–ù–û–ï**
- Score: 41% >= Threshold: 35%

### –ù–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ (max-level=3):
```
Mapped: 30/3069 persons
Validation Issues: 7
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- I500005 (–ú–∞–≥–¥–∞–ª–∏–Ω–∞, 1975) ‚úó NOT MATCHED - —Ç–µ–ø–µ—Ä—å –≤ unmatchedSource
- Score: 41% < Threshold: 50%

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Precision (–¢–æ—á–Ω–æ—Å—Ç—å)
‚úÖ **–£–ª—É—á—à–µ–Ω–æ**: –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π (false positives)

### Recall (–ü–æ–ª–Ω–æ—Ç–∞)
‚ö†Ô∏è **–í–æ–∑–º–æ–∂–Ω–æ —Å–Ω–∏–∂–µ–Ω–æ**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å—Ç–∏–Ω–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã (false negatives)

### Trade-off
**–õ—É—á—à–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, —á–µ–º —Å–æ–∑–¥–∞—Ç—å –ª–æ–∂–Ω–æ–µ.**

–ü—Ä–∏—á–∏–Ω—ã:
1. –õ–æ–∂–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ª–æ–º–∞—é—Ç –≤—Å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–µ—Ä–µ–≤–∞
2. –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –¥–æ–≤–µ—Ä—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

**Adaptive (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- Spouse threshold: 50%
- Parent threshold: 55%
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø–æ–ª–Ω–æ—Ç–æ–π

**Aggressive** - –¥–ª—è –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–±–æ–ª—å—à–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π)
- Spouse threshold: 40% (55 - 10 = 45, –Ω–æ clamp 40)
- Parent threshold: 45% (55 - 10 = 45)
- ‚ö†Ô∏è –†–∏—Å–∫ –ª–æ–∂–Ω—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π

**Conservative** - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ (–º–µ–Ω—å—à–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π)
- Spouse threshold: 65% (55 + 15 = 70, but might hit ceiling)
- Parent threshold: 70%
- ‚úÖ –ú–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–µ (2-4 –Ω–µ–¥–µ–ª–∏)

1. **–£—Å–∏–ª–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—É–ø—Ä—É–≥–æ–≤**
   - Birth year difference >5 –ª–µ—Ç = High severity (–≤–º–µ—Å—Ç–æ >15)
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ high severity issues

2. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ score breakdown –¥–ª—è –ø–µ—Ä—Å–æ–Ω**
   ```
   Spouse Match Attempt:
     Source: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ –ó–∞–π—Ü–µ–≤–∞ (1975)
     Dest:   –î–∞—Ä—å—è –ö–ª–∏–º–µ–Ω–∫–æ (1985)
     Score: 41% < Threshold: 50% ‚úó REJECTED
     Breakdown:
       ‚Ä¢ First Name: 8% (–ú–∞–≥–¥–∞–ª–∏–Ω–∞ vs –î–∞—Ä—å—è)
       ‚Ä¢ Last Name: 12% (–ó–∞–π—Ü–µ–≤–∞ vs –ö–ª–∏–º–µ–Ω–∫–æ)
       ‚Ä¢ Birth Year: 0% (10 years diff)
       ‚Ä¢ Gender: 10% (both Female)
   ```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ (1-2 –º–µ—Å—è—Ü–∞)

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º**
   - –î–∞–∂–µ –µ—Å–ª–∏ score >= threshold, —Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–∏–Ω–∏–º—É–º –ø–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –∞—Ç—Ä–∏–±—É—Ç–∞–º
   - –î–ª—è —Å—É–ø—Ä—É–≥–æ–≤: name similarity >= 30% –ò–õ–ò birth year diff <= 5

2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–∞ —Å—É–ø—Ä—É–≥–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–µ—Ç–µ–π
   - –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–±–µ–Ω–æ–∫ 2000 –≥–æ–¥–∞, —Å—É–ø—Ä—É–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~1960-1980

3. **Machine Learning**
   - –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫ –∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏

## –°—Ç–∞—Ç—É—Å

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ü–æ–≤—ã—à–µ–Ω—ã –ø–æ—Ä–æ–≥–∏ –¥–ª—è Spouse, Parent, Sibling
- ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: –õ–æ–∂–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ I500005 —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ
- ‚úÖ **–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ**: –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üìã **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**: –ü–ª–∞–Ω—ã –ø–æ –¥–∞–ª—å–Ω–µ–π—à–∏–º —É–ª—É—á—à–µ–Ω–∏—è–º

---

**–ê–≤—Ç–æ—Ä**: Claude Sonnet 4.5
**Reviewer**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–æ–±–Ω–∞—Ä—É–∂–∏–ª –ø—Ä–æ–±–ª–µ–º—É)
**–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞**: 2025-12-14
