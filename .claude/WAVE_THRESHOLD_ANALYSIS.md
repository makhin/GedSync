# Wave Compare Threshold Analysis

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ wave-compare —Å adaptive —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:

```bash
--anchor-source I500002 --anchor-destination I6000000206529622827 --max-level 1000
```

–ë—ã–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–≤–µ –ø–µ—Ä—Å–æ–Ω—ã:

**Source:**
- **–ú–∞–≥–¥–∞–ª–∏–Ω–∞ –®–æ—Ç–∞–µ–≤–Ω–∞ –ó–∞–π—Ü–µ–≤–∞** (@I500005@)
- –ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: 1975

**Destination:**
- **–î–∞—Ä—å—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞ –ö–ª–∏–º–µ–Ω–∫–æ** (@I6000000207133980738@)
- –ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: 1985

**Match Score:** 41%
**Threshold Used:** 35% (Spouse with 1 candidate)
**Result:** ‚úì MATCHED (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### 1. –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è —Å—É–ø—Ä—É–≥–æ–≤

–¢–µ–∫—É—â–∏–µ –ø–æ—Ä–æ–≥–∏ –≤ `ThresholdCalculator.cs`:

```csharp
RelationType.Spouse => 40,    // –ë–∞–∑–æ–≤—ã–π –ø–æ—Ä–æ–≥
candidateCount: 1 => -5,      // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è 1 –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
// –ò—Ç–æ–≥–æ: 40 - 5 = 35%
```

**35% - —ç—Ç–æ –∫—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥** –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞:
- –†–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ (–ú–∞–≥–¥–∞–ª–∏–Ω–∞ vs –î–∞—Ä—å—è)
- –†–∞–∑–Ω—ã–µ —Ñ–∞–º–∏–ª–∏–∏ (–ó–∞–π—Ü–µ–≤–∞ vs –ö–ª–∏–º–µ–Ω–∫–æ)
- –†–∞–∑–Ω–∏—Ü–∞ –≤ –¥–∞—Ç–∞—Ö —Ä–æ–∂–¥–µ–Ω–∏—è: 10 –ª–µ—Ç (1975 vs 1985)

### 2. Validation –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç

Validation –≤—ã—è–≤–∏–ª –ø—Ä–æ–±–ª–µ–º—É:

```json
{
  "severity": 1,  // Medium
  "type": 1,      // BirthYearMismatch
  "sourceId": "@I500005@",
  "destId": "@I6000000207133980738@",
  "message": "Birth year differs by 10 years (1975 vs 1985)"
}
```

–ù–æ —ç—Ç–æ **Medium severity**, –∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ **High severity**.

### 3. –ö–∞–∫ –ø–æ–ª—É—á–∏–ª—Å—è score 41%?

FuzzyMatcherService —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç:
- **–ò–º–µ–Ω–∞**: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ vs –î–∞—Ä—å—è - –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ (~10%)
- **–§–∞–º–∏–ª–∏–∏**: –ó–∞–π—Ü–µ–≤–∞ vs –ö–ª–∏–º–µ–Ω–∫–æ - –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ (~10%)
- **–î–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è**: 1975 vs 1985 - —Ä–∞–∑–Ω–∏—Ü–∞ 10 –ª–µ—Ç

–í–æ–∑–º–æ–∂–Ω–æ, score 41% –ø–æ–ª—É—á–∏–ª—Å—è –∏–∑-–∑–∞:
- –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ–ª–∞ (Female) - –Ω–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å
- –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã (–º–µ—Å—Ç–∞, —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏)
- FuzzyMatcher –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π score –¥–∞–∂–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ö–æ–¥—Å—Ç–≤–µ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ü–æ–≤—ã—Å–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è —Å—É–ø—Ä—É–≥–æ–≤:**

```csharp
// –í ThresholdCalculator.cs
var baseByRelation = relation switch
{
    RelationType.Anchor => 100,
    RelationType.Spouse => 55,    // –ë—ã–ª–æ: 40 ‚Üí –°—Ç–∞–ª–æ: 55
    RelationType.Parent => 55,    // –ë—ã–ª–æ: 45 ‚Üí –°—Ç–∞–ª–æ: 55
    RelationType.Child => 50,     // –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    RelationType.Sibling => 60,   // –ë—ã–ª–æ: 55 ‚Üí –°—Ç–∞–ª–æ: 60
    _ => 60
};
```

–ü–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:
- Spouse —Å 1 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º: 55 - 5 = **50%** (–≤–º–µ—Å—Ç–æ 35%)
- Parent —Å 2 –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏: 55 + 0 = **55%** (–≤–º–µ—Å—Ç–æ 45%)
- Sibling —Å 3-4 –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏: 60 + 5 = **65%** (–≤–º–µ—Å—Ç–æ 60%)

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–£—Å–∏–ª–∏—Ç—å validation –¥–ª—è —Å—É–ø—Ä—É–≥–æ–≤:**

```csharp
// –í WaveMappingValidator.cs
// –î–ª—è —Å—É–ø—Ä—É–≥–æ–≤ - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
if (newMapping.FoundVia == RelationType.Spouse)
{
    // Birth year difference >5 years = High severity
    if (sourcePerson.BirthYear.HasValue && destPerson.BirthYear.HasValue)
    {
        var diff = Math.Abs(sourcePerson.BirthYear.Value - destPerson.BirthYear.Value);
        if (diff > 5)  // –ë—ã–ª–æ: 15
        {
            issues.Add(new ValidationIssue
            {
                Severity = Severity.High,  // –ë—ã–ª–æ: Medium
                Type = IssueType.BirthYearMismatch,
                Message = $"Spouse birth year differs by {diff} years"
            });
        }
    }
}
```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –º–∞—Ç—á–∏–Ω–≥–∞ –ø–µ—Ä—Å–æ–Ω**

–î–æ–±–∞–≤–∏—Ç—å –≤ –ª–æ–≥ –¥–µ—Ç–∞–ª–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—É–ø—Ä—É–≥–æ–≤:
```
‚îÇ  ‚îÇ  Spouse Match Attempt:
‚îÇ  ‚îÇ    Source: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ –®–æ—Ç–∞–µ–≤–Ω–∞ –ó–∞–π—Ü–µ–≤–∞ (1975)
‚îÇ  ‚îÇ    Dest:   –î–∞—Ä—å—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞ –ö–ª–∏–º–µ–Ω–∫–æ (1985)
‚îÇ  ‚îÇ    ‚úì MATCHED (Score: 41%, Threshold: 35%)
‚îÇ  ‚îÇ    Score Breakdown:
‚îÇ  ‚îÇ      ‚Ä¢ First Name: 8% (–ú–∞–≥–¥–∞–ª–∏–Ω–∞ vs –î–∞—Ä—å—è)
‚îÇ  ‚îÇ      ‚Ä¢ Last Name: 12% (–ó–∞–π—Ü–µ–≤–∞ vs –ö–ª–∏–º–µ–Ω–∫–æ)
‚îÇ  ‚îÇ      ‚Ä¢ Birth Year: 0% (10 years difference)
‚îÇ  ‚îÇ      ‚Ä¢ Gender: 10% (Both Female)
‚îÇ  ‚îÇ      ‚Ä¢ Other: 11%
‚îÇ  ‚îÇ    ‚ö† Warning: Low confidence match
```

**2. –¢—Ä–µ–±–æ–≤–∞—Ç—å –º–∏–Ω–∏–º—É–º –ø–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º –∞—Ç—Ä–∏–±—É—Ç–∞–º**

–î–∞–∂–µ –µ—Å–ª–∏ –æ–±—â–∏–π score > threshold, —Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–∏–Ω–∏–º—É–º –ø–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –∞—Ç—Ä–∏–±—É—Ç–∞–º:
```csharp
// –î–ª—è —Å—É–ø—Ä—É–≥–æ–≤ —Ç—Ä–µ–±—É–µ–º:
// - Name similarity >= 30% –ò–õ–ò
// - Birth year difference <= 5 –ª–µ—Ç
if (relation == RelationType.Spouse)
{
    if (nameSimilarity < 30 && birthYearDiff > 5)
    {
        return null;  // Reject even if total score >= threshold
    }
}
```

**3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ–º—å–∏**

–ï—Å–ª–∏ –≤ —Å–µ–º—å–µ —É–∂–µ –µ—Å—Ç—å –¥–µ—Ç–∏:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç —Å—É–ø—Ä—É–≥–∞ –ª–æ–≥–∏—á–µ–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –¥–µ—Ç–µ–π
- –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–±–µ–Ω–æ–∫ 2000 –≥–æ–¥–∞, —Ç–æ —Å—É–ø—Ä—É–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ 1960-1980

## –¢–µ—Å—Ç–æ–≤—ã–π —Å–ª—É—á–∞–π

### –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

```
Anchor: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á –ú–∞—Ö–∏–Ω (1974) ‚Üí Matched
Family: @F500003@
  Husband: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (already mapped)
  Wife: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ –ó–∞–π—Ü–µ–≤–∞ (1975)

Dest Family: @F6000000207133980774@
  Husband: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (already mapped)
  Wife: –î–∞—Ä—å—è –ö–ª–∏–º–µ–Ω–∫–æ (1985)

Match: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ ‚Üí –î–∞—Ä—å—è (Score: 41% >= Threshold: 35%) ‚úì WRONG!
```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ü–†–ê–í–ò–õ–¨–ù–û)

```
Anchor: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á –ú–∞—Ö–∏–Ω (1974) ‚Üí Matched
Family: @F500003@
  Husband: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (already mapped)
  Wife: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ –ó–∞–π—Ü–µ–≤–∞ (1975)

Dest Family: @F6000000207133980774@
  Husband: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (already mapped)
  Wife: –î–∞—Ä—å—è –ö–ª–∏–º–µ–Ω–∫–æ (1985)

Match Attempt: –ú–∞–≥–¥–∞–ª–∏–Ω–∞ ‚Üí –î–∞—Ä—å—è
  Score: 41% < Threshold: 50% ‚úó REJECTED
  Reason: Score below threshold
  OR
  Score: 41% >= Threshold: 35% but VALIDATION FAILED
  Reason: Birth year differs by 10 years (High severity)
```

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

–ü—Ä–∏–º–µ–Ω–∏—Ç—å **–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. –ü–æ–≤—ã—Å–∏—Ç—å `RelationType.Spouse` —Å 40 –¥–æ 55
2. –ü–æ–≤—ã—Å–∏—Ç—å `RelationType.Parent` —Å 45 –¥–æ 55
3. –ü–æ–≤—ã—Å–∏—Ç—å `RelationType.Sibling` —Å 55 –¥–æ 60

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç:
- Spouse threshold: 50% (–≤–º–µ—Å—Ç–æ 35%)
- Parent threshold: 55% (–≤–º–µ—Å—Ç–æ 45%)
- –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–° –Ω–æ–≤—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏:
- –ú–∞–≥–¥–∞–ª–∏–Ω–∞ (41%) < Threshold (50%) ‚úó –ù–ï –±—É–¥–µ—Ç —Å–º–∞—Ç—á–µ–Ω–∞
- –ú–Ω–æ–≥–∏–µ –ª–æ–∂–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å—Ç–∏–Ω–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∂–µ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã (false negatives)

**Trade-off**: –õ—É—á—à–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, —á–µ–º —Å–æ–∑–¥–∞—Ç—å –ª–æ–∂–Ω–æ–µ.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

–ù—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
1. –ö–∞–∫ FuzzyMatcherService –ø–æ–ª—É—á–∏–ª score 41% –¥–ª—è —Ç–∞–∫–∏—Ö —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω?
2. –ï—Å—Ç—å –ª–∏ –¥—Ä—É–≥–∏–µ –ª–æ–∂–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö?
3. –ö–∞–∫–æ–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É precision –∏ recall?

---

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –í—ã—Å–æ–∫–∏–π
**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-12-14
